{% extends "layouts/main.html" %}

{% set navItems = [
  { text: "Home", href: "index", active: false },
  { text: "Cases", href: "cases", active: true },
  { text: "Search", href: "#", active: false }
] %}

{% set pageName="Location activitiy, Richard Marks" %}

{% block content %}
{% block breadcrumb %}
  {% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
  {{ govukBreadcrumbs({
    items: [
      { text: "Cases", href: "/cases" },
      { text: "Richard Marks", href: "richard-marks" }
    ]
  }) }}
{% endblock %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
          <span class="govuk-caption-m govuk-!-margin-bottom-2">
        <abbr title="Case reference number" style="text-decoration: none">CRN</abbr>: X778126 
        <span class="govuk-!-padding-left-3 govuk-!-padding-right-3 hide-mobile">|</span>
        Date of birth: 23 April 1996 (Age 27)
        <span class="govuk-!-padding-left-3 govuk-!-padding-right-3 hide-mobile">|</span>
        Sentence: GPS community single order​​
      </span>
    <h1 class="govuk-heading-l govuk-!-margin-bottom-4">
      Richard Marks
    </h1>
  </div>
</div>

<!--
{{ mojAlert({
  variant: "warning",
  title: "Failure to charge battery",
  showTitleAsHeading: true,
  dismissible: true,
  html: '<a href="#">View Richard&apos;s tag breaches</a>.'
}) }}

{{ mojAlert({
  variant: "warning",
  title: "4 locations of interest visited in the last 7 days",
  showTitleAsHeading: true,
  dismissible: true,
  html: '<a href="#">View Richard&apos;s locations of interest</a>.'
}) }}
-->

{{ mojSubNavigation({
  label: "Sub navigation",
  items: [{
    text: "Overview",
    href: "richard-marks"
  }, {
    text: "Location activity",
    href: "",
    active: true
  }, {
    text: "Case notes",
    href: "rm-case-notes-ems"
  }]
}) }}

<h2 class="govuk-heading-m" id="map-header">Location activity</h2>

<h3 class="govuk-heading-s">Interactive map</h3>

<div class="govuk-!-margin-bottom-6">
  <div id="map-status" class="govuk-visually-hidden" aria-live="polite"></div>
  
  <div id="map" style="height: 600px;"></div>

  <p class="govuk-body-s"><a href="map-help">Help with the map</a></p>
</div>

<h3 class="govuk-heading-s">Locations of interest</h3>

<div class="loi-filters govuk-!-margin-bottom-3">
  <form id="loi-filters" class="loi-filters__form" novalidate data-tag-fitted="2025-06-08">
    <div class="loi-filters__row">
      <div class="loi-filters__group">
        <label class="govuk-label" for="filter-type">Location</label>
        <select class="govuk-select" id="filter-type" name="filter-type">
          <option value="">All location types</option>
          <option value="non-home">All locations (not including home)</option>
          <option>Home</option>
          <option>Public house</option>
          <option>Sports and recreational facilities</option>
          <option>Licensed betting office</option>
        </select>
      </div>

      <div class="loi-filters__group">
        <label class="govuk-label" for="filter-date">Date range</label>
        <select class="govuk-select" id="filter-date" name="filter-date">
          <option value="" id="all-dates-option">All dates</option>
          <option value="last7">Last 7 days</option>
          <option value="last30">Last 30 days</option>
        </select>
      </div>

      <div class="loi-filters__actions">
        <button class="govuk-button" data-module="govuk-button" id="apply-loi-filters" type="submit">
          Filter locations
        </button>
      </div>
    </div>

    <div class="loi-filters__footer">
      <a href="#" id="clear-loi-filters" class="govuk-link">Clear filters</a>
    </div>

    <div id="loi-filter-status" class="govuk-visually-hidden" aria-live="polite"></div>
  </form>
</div>


{{ govukTable({
  attributes: { "data-module": "moj-sortable-table" },
  head: [
    { text: "Date", attributes: { "aria-sort": "descending" } },
    { text: "Location type", attributes: { "aria-sort": "none" } },
    { text: "Address" },
    { text: "Time", attributes: { "aria-sort": "none" }, classes: "no-wrap" },
    { text: "View on map" }
  ],
  rows: [
    [
      { html: "Thursday 24 July<br/>2025", attributes: { "data-sort-value": "2025-07-24" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "10:57pm to 11:59pm<br/>(1 hour 2 mins)", attributes: { "data-sort-value": "62" }, classes: "no-wrap" },
      { html: '<a href="#" class="plot-link govuk-link no-wrap" data-trace="home">View</a>' }
    ],
    [
      { html: "Thursday 24 July<br/>2025", attributes: { "data-sort-value": "2025-07-24" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "9:33pm to 10:42pm<br/>(1 hour 9 mins)", attributes: { "data-sort-value": "69" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h1">View</a>' }
    ],
    [
      { html: "Thursday 24 July<br/>2025", attributes: { "data-sort-value": "2025-07-24" } },
      { text: "Public house", attributes: { "data-sort-value": "public house" } },
      { html: "The Fusilier Bar & Restaurant<br/>Aingers Green Rd<br/>Aingers Green<br/>Great Bentley<br/>Colchester<br/>CO7 8NH" },
      { html: "7:13pm to 9:27pm<br/>(2 hours 14 mins)", attributes: { "data-sort-value": "134" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="fusilier">View</a>' }
    ],
    [
      { html: "Thursday 24 July<br/>2025", attributes: { "data-sort-value": "2025-07-24" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 8:33am<br/>(8 hours 33 mins)", attributes: { "data-sort-value": "513" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h2">View</a>' }
    ],
    [
      { html: "Wednesday 23 July<br/>2025", attributes: { "data-sort-value": "2025-07-23" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 11:59pm<br/>(11 hours 59 mins)", attributes: { "data-sort-value": "719" }, classes: "no-wrap" },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h3">View</a>' }
    ],
    [
      { html: "Tuesday 22 July<br/>2025", attributes: { "data-sort-value": "2025-07-22" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 11:59pm<br/>(11 hours 59 mins)", attributes: { "data-sort-value": "719" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h4">View</a>' }
    ],
    [
      { html: "Monday 21 July<br/>2025", attributes: { "data-sort-value": "2025-07-21" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "11:38pm to 11:59pm<br/>(21 mins)", attributes: { "data-sort-value": "21" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h5">View</a>' }
    ],
    [
      { html: "Monday 21 July<br/>2025", attributes: { "data-sort-value": "2025-07-21" } },
      { text: "Public house", attributes: { "data-sort-value": "public house" } },
      { html: "The Fusilier Bar & Restaurant<br/>Aingers Green Rd<br/>Aingers Green<br/>Great Bentley<br/>Colchester<br/>CO7 8NH" },
      { html: "7:32pm to 11:05pm<br/>(3 hours 33 mins)", attributes: { "data-sort-value": "213" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="fusilier">View</a>' }
    ],
    [
      { html: "Monday 21 July<br/>2025", attributes: { "data-sort-value": "2025-07-21" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 9:13am<br/>(9 hours 13 mins)", attributes: { "data-sort-value": "553" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h6">View</a>' }
    ],
    [
      { html: "Sunday 20 July<br/>2025", attributes: { "data-sort-value": "2025-07-20" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "9:45pm to 11:59pm<br/>(2 hours 14 mins)", attributes: { "data-sort-value": "134" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h7">View</a>' }
    ],
    [
      { html: "Sunday 20 July<br/>2025", attributes: { "data-sort-value": "2025-07-20" } },
      { text: "Sports and recreational facilities", attributes: { "data-sort-value": "sports" } },
      { html: "Colchester Sports Park<br/>Cuckoo Farm Way,<br/>Colchester,<br/>Essex<br/>CO4 5YX" },
      { html: "9:49am to 11:03am<br/>(1 hour 14 mins)", attributes: { "data-sort-value": "74" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="sports-park">View</a>' }
    ],
    [
      { html: "Sunday 20 July<br/>2025", attributes: { "data-sort-value": "2025-07-20" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 9:03am<br/>(9 hours 3 mins)", attributes: { "data-sort-value": "543" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h8">View</a>' }
    ],
    [
      { html: "Saturday 19 July<br/>2025", attributes: { "data-sort-value": "2025-07-19" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 11:59pm<br/>(11 hours 59 mins)", attributes: { "data-sort-value": "719" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h9">View</a>' }
    ],
    [
      { html: "Thursday 10 July<br/>2025", attributes: { "data-sort-value": "2025-07-10" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "7:04pm to 11:59pm<br/>(4 hours 55 mins)", attributes: { "data-sort-value": "295" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h10">View</a>' }
    ],
    [
      { html: "Thursday 10 July<br/>2025", attributes: { "data-sort-value": "2025-07-10" } },
      { text: "Licensed betting office", attributes: { "data-sort-value": "licensed betting office" } },
      { html: "Ladbrokes<br/>41, 42 St Botolph's St<br/>Colchester<br/>CO2 7EA" },
      { html: "12:21pm to 12:36pm<br/>(15 mins)", attributes: { "data-sort-value": "15" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="ladbrokes">View</a>' }
    ],
    [
      { html: "Thursday 10 July<br/>2025", attributes: { "data-sort-value": "2025-07-10" } },
      { text: "Home", attributes: { "data-sort-value": "home" } },
      { html: "46-6 Rainsborowe Rd<br/>Colchester" },
      { html: "00:00am to 11:13am<br/>(11 hours 13 mins)", attributes: { "data-sort-value": "673" } },
      { html: '<a href="#" class="plot-link govuk-link" data-trace="home-h11">View</a>' }
    ]
  ]
}) }}




{{ govukPagination({
  next: {
    href: "#"
  },
  items: [
    {
      number: 1,
      current: true,
      href: "#"
    },
    {
      number: 2,
      href: "#"
    },
    {
      number: 3,
      href: "#"
    }
  ]
}) }}


<h3 class="govuk-heading-s" id="tag-breaches">Compliance</h3>

<section class="app-summary-card govuk-!-margin-bottom-6 app-summary-card--large-title">
  <header class="app-summary-card__header">
    <h3 class="app-summary-card__title">Tag and home monitoring unit (HMU)</h3>
    <!--div class="app-summary-card__actions">
      <a class="govuk-link plot-map" href="#">View all contact details</a>
    </div -->
  </header>

  <div class="app-summary-card__body">
    <dl class="govuk-summary-list">
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          <span class="govuk-!-font-weight-regular">EMS were unable to fit Richard’s GPS tag on Wednesday 5 and Friday 7 March 2025 as Richard was not available at their approved address. Their tag was fitted on Wednesday 12 March 2025.</span>
        </dt>
      </div>
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">

{{ govukTable({
  attributes: {
    "data-module": "moj-sortable-table"
  },
  caption: "Tag tampers and battery recharging",
  head: [
    {
      text: "Date",
      attributes: {
        "aria-sort": "ascending"
      }
    },
    {
      text: "Time"
    },
    {
      text: "Tamper type",
      attributes: {
        "aria-sort": "none"
      }
    }
  ],
  rows: [
    [
      {
        text: "Tuesday 8 April 2025"
      },
      {
        text: "12.36pm"
      },
      {
        html: '<span class="govuk-!-font-weight-bold govuk-error-message">Strap cut</span>'
      }
    ],
    [
      {
        text: "Thursday 10 April 2025"
      },
      {
        text: "7.54pm"
      },
      {
        html: '<span class="govuk-!-font-weight-bold govuk-error-message">Case open</span>'
      }
    ],
    [
      {
        text: "Tuesday 15 April 2025"
      },
      {
        text: "6.05am"
      },
      {
        html: '<span class="govuk-!-font-weight-bold govuk-error-message">Case open</span>'
      }
    ],
    [
      {
        text: "Friday 18 April 2025"
      },
      {
        text: "9.44pm"
      },
      {
        html: '<span class="govuk-!-font-weight-bold govuk-error-message">Strap cut</span>'
      }
    ]
  ]
}) }}

  {{ govukTable({
  attributes: {
    "data-module": "moj-sortable-table"
  },
  caption: "Home monitoring unit (HMU) tampers",
  head: [
    {
      text: "Date",
      attributes: {
        "aria-sort": "ascending"
      }
    },
    {
      text: "Time"
    },
    {
      text: "Tamper type",
      attributes: {
        "aria-sort": "none"
      }
    }
  ],
  rows: [
    [
      {
        text: "Tuesday 8 April 2025"
      },
      {
        text: "12.36pm"
      },
      {
        html: '<span class="govuk-!-font-weight-bold govuk-error-message">HMU moved</span>'
      }
    ]
  ]
}) }}
        </dt>
      </div>
    </dl>
  </div>
</section>



<!-- Leaflet core -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
</script>

<!-- PolylineDecorator -->
<script src="/public/javascripts/leaflet.polylineDecorator.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Map logic -->
<script src="/public/javascripts/gps-map.js"></script>

<!-- Table filtering -->
<script src="/public/javascripts/loi-filters.js"></script>

<!-- Duration calculator -->
<script src="/public/javascripts/duration-helper.js"></script>

<!-- Toggling for map layers -->
<script src="/public/javascripts/map-overlays.js"></script>


 

<script>
  // Create the map
  window.map = L.map('map').setView([51.889, 0.903], 13);

  // Base layers
  const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors',
    maxZoom: 19
  });

  const satellite = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    {
      attribution: 'Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
      maxZoom: 19
    }
  );

  // Add default base
  street.addTo(window.map);

    // North arrow
(function addNorthArrow() {
  if (!window.map) return;
  const compass = L.control({ position: 'topleft' });
  compass.onAdd = function () {
    const bar = L.DomUtil.create('div', 'leaflet-bar');
    const a = L.DomUtil.create('a', '', bar);
    a.href = '#';
    a.title = 'North';
    a.setAttribute('aria-label', 'North arrow');
    // simple up-triangle SVG
    a.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><polygon points="12,3 20,21 12,16 4,21" /></svg>';
    // don’t let it scroll/jump
    L.DomEvent.on(a, 'click', (e) => L.DomEvent.stop(e));
    return bar;
  };
  compass.addTo(window.map);
})();

  // Layer toggles
  setupMapOverlays({
    map: window.map,
    baseLayers: { 'Street': street, 'Satellite': satellite },
    // storageKey: 'loi-overlay-pref:v1' // shared across all three pages (keeps user choice)
    // If you’d rather keep per-person prefs, use a different key per page:
    // storageKey: 'loi-overlay-pref:richard' / ':penny' / ':billy'
  });
  
  // Restore last base
  const lastBase = localStorage.getItem('loi-base') || 'street';
  (lastBase === 'satellite' ? satellite : street).addTo(window.map);

  // Save when toggled
  window.map.on('baselayerchange', function (e) {
    localStorage.setItem('loi-base', e.name.toLowerCase());
  });
</script>



{% endblock %}